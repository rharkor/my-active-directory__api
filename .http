# Daigis Api
@url = http://localhost:3001

// Change the auth token with the one you get from the login request
@authToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFkbWluQGFkbWluLmNvbSIsInVzZXJuYW1lIjoiYWRtaW4iLCJmaXJzdE5hbWUiOm51bGwsImxhc3ROYW1lIjpudWxsLCJtZXRhZGF0YSI6bnVsbCwiaWQiOjcsInJvbGVzIjpbeyJpZCI6MiwibmFtZSI6InN1cGVyLWFkbWluIiwiZGlzcGxheU5hbWUiOiJTdXBlciBBZG1pbiIsImRlc2NyaXB0aW9uIjoiU3VwZXIgYWRtaW4gb2YgdGhlIGFwcGxpY2F0aW9uLCBjYW4gZG8gYW55dGhpbmciLCJkZWxldGFibGUiOmZhbHNlfV0sImlhdCI6MTY4ODEyMzQ2MSwiZXhwIjoxNjk4NDkxNDYxfQ.YIbz1hlsMVLQFwIpuBO99RVCjNY8GerOnWsCz9dYpwQ
@authTokenAdmin = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InRlc3RAdGVzdC5jb20iLCJyb2xlcyI6W3t9XSwidXNlcm5hbWUiOm51bGwsImZpcnN0TmFtZSI6bnVsbCwibGFzdE5hbWUiOm51bGwsIm1ldGFkYXRhIjpudWxsLCJpZCI6OCwiaWF0IjoxNjg4MTI2OTYwLCJleHAiOjE2OTg0OTQ5NjB9.iWDye7Y9aSq7XtESf6kKA7ZoNMX6VfAw0Om5_wdoCEM

## Status
### Test the status of the api
GET {{ url }}

##* BASICS
@authUrl = {{ url }}/auth

###? Register first user
POST {{ authUrl }}/register/init
Content-Type: application/json

{
  "email": "admin@admin.com",
  "username": "admin",
  "password": "Azerty1234!"
}

###? Get profile
GET {{ authUrl }}/profile
Authorization: Bearer {{ authToken }}

###? Login
POST {{ authUrl }}/login
Content-Type: application/json

{
  "email": "admin@admin.com",
  "password": "Azerty1234!"
}

###? Update
PATCH {{ url }}/users/7
Authorization: Bearer {{ authToken }}
Content-Type: application/json

{
  "password": "Azerty1234!"
}


###? Create a new user with role admin
POST {{ url }}/auth/register
Authorization: Bearer {{ authToken }}
Content-Type: application/json

{
  "email": "test@test.com",
  "password": "Azerty1234!",
  "roles": ["admin"]
}

###? Get all users
GET {{ url }}/users
Authorization: Bearer {{ authToken }}

###? Get one user
GET {{ url }}/users/17
Authorization: Bearer {{ authToken }}

###? Create a service-account
POST {{ url }}/service-account
Authorization: Bearer {{ authTokenAdmin }}
Content-Type: application/json

{
  "name": "service-account1"
}

###? Get all service-accounts
GET {{ url }}/service-account
Authorization: Bearer {{ authTokenAdmin }}

###? Delete one user
DELETE {{ url }}/users/16
Authorization: Bearer {{ authTokenAdmin }}


##* MAD

@serviceAccountToken = 2572bf1d-48f6-4e6f-85fb-9f5596e4186d

###? Create a user with role test
POST {{ url }}/auth/register
X-Api-Key: {{ serviceAccountToken }}
Content-Type: application/json

{
  "email": "user2@user.com",
  "password": "Azerty1234!",
  "roles": ["test"],
  "firstName": "John",
  "lastName": "Doe",
  "metadata": {
    "age": 20
  }
}

###? Get all users
GET {{ url }}/users
X-Api-Key: {{ serviceAccountToken }}

###? Get one user
GET {{ url }}/users/7
X-Api-Key: {{ serviceAccountToken }}

###? Delete one user
DELETE {{ url }}/users/11
X-Api-Key: {{ serviceAccountToken }}

###? Update one user
PATCH {{ authUrl }}/update
X-Api-Key: {{ serviceAccountToken }}
Content-Type: application/json

{
  "id": 9,
  "firstName": "Joh",
  "lastName": "Doe",
  "metadata": {
    "age": 20
  }
}

###? The user can login
POST {{ authUrl }}/login
Content-Type: application/json

{
  "email": "user@user.com",
  "password": "Azerty1234!"
}

@userToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InVzZXJAdXNlci5jb20iLCJmaXJzdE5hbWUiOiJKb2huIiwibGFzdE5hbWUiOiJEb2UiLCJtZXRhZGF0YSI6eyJhZ2UiOjIwfSwicm9sZXMiOlt7fV0sInVzZXJuYW1lIjpudWxsLCJpZCI6MTIsImlhdCI6MTY4ODM5MTM5NSwiZXhwIjoxNjk4NzU5Mzk1fQ.jJ8LVhmJFx6BaieNb2_3Ta3svAXz6xki8PPc5C2vZSY

###? Get profile
GET {{ authUrl }}/profile
Authorization: Bearer {{ userToken }}


###? Get roles of the user
GET {{ url }}/users/7/roles
X-Api-Key: {{ serviceAccountToken }}

###? Get roles with filter
GET {{ url }}/users/7/roles?filter.id=$eq:2
X-Api-Key: {{ serviceAccountToken }}

###? Get all roles
GET {{ url }}/roles
X-Api-Key: {{ serviceAccountToken }}

###? Get all roles with user (no access)
GET {{ url }}/roles
Authorization: Bearer {{ userToken }}
